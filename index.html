<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>pleiades.stoa.org</title>
  <meta name="description" content="Pleiades gives scholars, students, and enthusiasts worldwide the ability to use, create, and share historical geographic information about the ancient world in digital form.">
  <meta name="author" content="">

  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- CSS concatenated and minified via ant build script-->
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.css" />
  <link rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"/>
  <!-- end CSS-->

  <script src="js/libs/modernizr-2.0.6.min.js"></script>
</head>

<body>

  <div id="container">
    
    <header id="header">
     <img class="logo" src="img/pleiades-logo-neg-tag.png" alt="Pleiades Logo">
    </header>
    
    <div id="main" role="main">

    <div id="middle">
      <div class="middle align-center">
        <p class="app-welcome">
          A community-built gazetteer and graph of ancient places
        </p>
      </div>
    </div>

    <div id="bottom">
      <!-- class="bottom align-center" -->
      <div id="map" title="A slideshow of random places from Pleiades. Press P to pause/play, J to go back one step, or K to advance. Press Esc to terminate the slideshow. Reload the page to begin again."></div>
      <div id="links" class="bottom align-center">
        <p>
          <a href="http://pleiades.stoa.org/home">Project Home</a> &#183;
          <a href="http://pleiades.stoa.org/places">Places</a> &#183;
          <a href="http://pleiades.stoa.org/vocabularies">Vocabularies</a> &#183;
          <a href="http://pleiades.stoa.org/docs">Documents</a> &#183;
          <a href="http://pleiades.stoa.org/help">Help</a> &#183;
          <a href="http://pleiades.stoa.org/news/blog">Blog</a> &#183;
          <a href="http://pleiades.stoa.org/credits">Credits</a>
        </p>
      </div>
      <div id="search-form" class="bottom align-center">
        <br/>
        <form action="http://pleiades.stoa.org/search">
          <fieldset>
            <legend id="placesSearchLegend" style="visibility:hidden">Search the 42 Places</legend>
            <input class="text" type="text" id="q" name="SearchableText" cols="40" placeholder="Internum Mare" value="" required="1">
            <input type="hidden" name="portal_type" value="Place">
            <input class="submit" type="submit" name="submit" value="Search">
          </fieldset>
        </form>
        <br/>
      </div>

      <div id="more">
        <div class="left">
          <p>Pleiades is a historical gazetteer and more. It gives scholars, students and enthusiasts worldwide the ability to use, create, share, and map historical geographic information about the ancient world. It associates names and locations in time and provides structured information about the quality and provenance of these entities.</p>
          <p>There is also a graph in Pleiades: names and locations are collected into conceptual bundles (places) and these collections are associated with other geographically connected places.</p>
          <p>Pleiades identifies and defines places within the emerging web of ancient world linked data. It serves as the authoritative hub of an expanding constellation of digital publications and databases that treat the histories, languages, texts, and artifacts of antiquity.</p>
          <p><a href="http://pleiades.stoa.org/places/">More about the data ...</a></p>
        </div>
        <div class="right">
        <p>Pleiades is one hundred percent open source, one hundred percent openly licensed and one hundred percent editable.</p>
        <p>Our open source software gets used and improved by a diverse crowd of programmers in the humanities and beyond. Our openly licensed resources have no costs attached, no surprises or encumberances.</p>
        <p>Pleiades is a continuously published scholarly reference work for the 21st century. We embrace the new paradigm of citizen humanities, encouraging contributions from any knowledgeable person and doing so in a context of pervasive peer review.  Pleiades welcomes your contribution, no matter how small, and we have a number of useful tasks suitable for volunteers of every interest.</p>
        <p><a href="http://pleiades.stoa.org/welcome">More about contributing ...</a></p>
        </div>
        <div class="clearfix"></div>
      </div>
    </div>



    <div id="sponsors" class="bottom align-center">
      <p>Pleiades is supported by:</p>
      <img src="img/NEH-Logo-Horizontal_RGB.png"></div>
    </div>

    <footer id="footer">
      <div class="rights">Some rights reserved (cc-by) Ancient World Mapping Center, Institute for the Study of the Ancient World and the Contributors</div>
    </footer>

  </div> <!--! end of #container -->

  <!-- Map info window content template -->
  <div id="infoWindowContent" style="display:none">
    <div id="iwcContainer" class="align-center">
      <p id="iwcTitle">
        <span class="title">
          <a id="detailsLink" href="#" title="Click for details">Title</a>
        </span>
      </p>
      <p id="iwcByline" class="byline">Last Modified 2011-01-01 by sgillies</p>
      <p id="iwcDescription">Description</p>
    </div>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>
  <script>
      /* Get count of places from API status */
      $.getJSON(
        "http://pleiades.stoa.org/api/status", 
        function(data) {
          $("#placesSearchLegend", document).text(
            "Search the " +
            data['num_places'].toString().replace(
              /\B(?=(?:\d{3})+(?!\d))/g, ",") +
            " Places" );
          $("#placesSearchLegend", document).css("visibility", "visible");
        });
  </script>
  <script src="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.js"></script>
  <script>
    var latlng0 = new L.LatLng(35.0, 20.0);
    
    /* Map is initialized in the show() function below */
    var map = null;
    
    var tiles = L.tileLayer(
    //    'http://static.ahlfeldt.se/srtm/imperium/{z}/{x}/{y}.png', {
        'http://api.tiles.mapbox.com/v3/isawnyu.map-p75u7mnj/{z}/{x}/{y}.png', {
            maxZoom: 7
            });
            
    var placeIcon = new L.Icon({
        iconUrl: "http://atlantides.org/images/justice-blue.png" });
    var marker = new L.Marker([-90, 45], {icon: placeIcon});

    var msg = null;
    var infoWindow = new L.Popup({
        offset: new L.Point(16, 3),
        closeButton: false,
        maxWidth: 500 });

    var current = null;
    var next = [];
    var prev = [];

    var timer = null;
    var count = 0;
    var limit = 100;
    var interval = 8000;
    
    /* Begin in recent-seeking state */
    var state = "recent-seeking";
    var url = "http://pleiades.stoa.org/api/ssdRecentPlaceJson";

    function play() {
      
      if (count > limit) {
        if (state == "recent-seeking") { // switch state
          state = "any-seeking";
          count = 0;
          url = "http://pleiades.stoa.org/api/ssdAnyPlaceJson";
        }
        else { // quit
          current = null;
          return null;
        }
      }
      if (current != null) {
        prev.push(current);
      }
      if (next.length == 0) {
        $.getJSON(url, function(data) {
          limit = data['limit'];
          current = data['results'][0]['id'];
          if ($.inArray(current, prev) < 0 && 
              $.inArray(current, next) < 0) {
            show(data['results'][0]);
          }
          else {
            current = data['results'][1]['id'];
            show(data['results'][1]);
          }
        });
      }
      else {
        current = next.shift();
        var nextUrl = "http://pleiades.stoa.org/places/" + current + "/json";
        $.getJSON(nextUrl, function(data) {
          current = data["id"];
          show(data);
        });
      }
      count = count + 1;
      timer = setTimeout(play, interval);
    }

    function forward() {
      if (current != null) { prev.push(current); }
      if (next.length == 0) {
        $.ajax({
          url: url,
          dataType: 'json',
          headers: {'If-None-Match': '*'},
          success: function(data) {
            limit = data['limit'];
            current = data['results'][0]['id'];
            if ($.inArray(current, prev) < 0 && 
                $.inArray(current, next) < 0) {
              show(data['results'][0]);
            }
            else {
              current = data['results'][1]['id'];
              show(data['results'][1]);
            }
          }
        });
      }
      else {
        current = next.shift();
        var nextUrl = "http://pleiades.stoa.org/places/" + current + "/json";
        $.getJSON(nextUrl, function(data) {
          current = data["id"];
          show(data);
        });
      }
    }

    function back() {
      if (current != null) { next.unshift(current); }
      if (prev.length > 0) {
        current = prev.pop();
        var backUrl = "http://pleiades.stoa.org/places/" + current + "/json";
      }
      else {
        return null;
      }
      $.getJSON(backUrl, function(data) {
        current = data["id"];
        show(data);
      });
    }

    function show(data) {

      var bounds = data["bbox"];
      if (bounds == null) {
        latlng = latlng0;
      }
      else {
        latlng = new L.LatLng(
          (bounds[1]+bounds[3])/2.0, (bounds[0]+bounds[2])/2.0);
      }

      if (map == null) {
        map = L.map('map', {
          center: latlng,
          zoom: 6,
          closePopupOnClick: false,
          dragging: false,
          touchZoom: false,
          scrollWheelZoom: false,
          doubleClickZoom: false,
          boxZoom: false,
          keyboard: false,
          zoomControl: false,
          attributionControl: false });
        tiles.addTo(map);
        marker.addTo(map);
      }

      map.closePopup();
      var msg = $("#infoWindowContent").clone(true, true);
      var link = "http://pleiades.stoa.org/places/" + data["id"];
      $("#iwcTitle #detailsLink", msg).attr("href", link);
      $("#iwcTitle #detailsLink", msg).text(data["title"]);
      $("#iwcDescription", msg).text(data["description"]);

      if (data["recent_changes"] != null) {
        var items = $.map(data["recent_changes"], function(value){
          var q = value["modified"];
          var modified = new Date(
            Date.UTC(
              parseInt(q.substring(0,4)),
              parseInt(q.substring(5,7))-1,
              parseInt(q.substring(8,10)),
              parseInt(q.substring(11,13)),
              parseInt(q.substring(14,16))))
          return modified.toDateString() + " by " + value["principal"];
          });
        $("#iwcByline", msg).text("Last modified: " + items.join(", "));
      }
      else {
        $("#iwcByline", msg).hide();
      }

      $(msg).show();
      $("iwcNav", msg).hide();
      
      infoWindow.setLatLng(latlng);
      infoWindow.setContent($(msg).html());
      
      marker.setLatLng(latlng);
      map.openPopup(infoWindow);

      if (bounds == null) {
        map.panTo([latlng.lat+2.0, latlng.lng]);
        map.setZoom(5);
      }
      else {
        map.panTo([latlng.lat+1.2, latlng.lng]);
        map.setZoom(6);
      }
    }

    $(document).keyup(function(e) {
      if (e.keyCode == 27) { count = limit + 1; } // esc ends the slideshow
      /* Toggle pause/play with p key */
      else if (e.keyCode == 80) {
        if (timer == null) {
          timer=setTimeout(play, 500);
        }
        else {
          clearTimeout(timer);
          timer = null;
        }
      }
      else if (e.keyCode == 74) { back(); } // j goes back
      else if (e.keyCode == 75) { forward(); } // j goes forward
    });

    $(document).ready(function(){play();});

  </script>

  <!-- scripts concatenated and minified via ant build script-->
  <!--script defer src="js/plugins.js"></script-->
  <!--script defer src="js/script.js"></script-->
  <!-- end scripts-->


  <script> // Change UA-XXXXX-X to be your site's ID
    window._gaq = [['_setAccount','UA-3702316-7'],['_trackPageview'],['_trackPageLoadTime']];
    Modernizr.load({
      load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
    });
  </script>


  <!--[if lt IE 7 ]>
    <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->
  
</body>
</html>
